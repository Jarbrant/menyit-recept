<!-- ============================================================
     FIL: pages/recipes.html  (HEL FIL)
     Sida 1: Receptlista (modern)
     PATCH: AO-RECIPES-SEARCH-02 (FAS 1)
     - Topbar: ta bort Fel-ingr + Anv-ingr (förkortningar ska inte användas)
     - Hjälp kvar
     - Behåller: flyttat sökfält + hjälp-popover + +Skapa ny
     Policy: statisk GitHub Pages, inga externa libs, XSS-safe (render via textContent)
============================================================ -->
<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kostdata — Recept</title>
  <link rel="stylesheet" href="../assets/css/main.css" />
</head>
<body>

  <!-- TOPBAR -->
  <header class="topbar">
    <div class="topbarInner">
      <div class="brand">
        <button class="backBtn" id="backBtn" title="Tillbaka" aria-label="Tillbaka">←</button>
        <div>
          <div class="pageTitle">Recept</div>
          <div class="muted small">Sök och hantera recept</div>
        </div>
      </div>

      <!-- (Flyttat) Sökfältet ligger i hero nu -->
      <div class="centerSlot"></div>

      <div class="rightSlot" style="position:relative;">
        <button class="btn" id="helpBtn" type="button" aria-haspopup="dialog" aria-expanded="false">Hjälp</button>

        <!-- BORTTAGET (AO-RECIPES-SEARCH-02): Fel ingrediens + Använda ingredienser
             Tidigare:
             <a class="btn" href="./recipe-disabled-ingredients.html" ...>Fel-ingr</a>
             <a class="btn" href="./recipe-used-ingredients.html" ...>Anv-ingr</a>
        -->

        <button class="btn btnPrimary" id="createBtn">+ Skapa ny</button>

        <!-- Hjälpruta (popover) -->
        <div id="helpPop"
             class="card"
             role="dialog"
             aria-label="Hjälp"
             style="
               display:none;
               position:absolute;
               right:0;
               top:48px;
               width:min(380px, 92vw);
               padding:14px;
               box-shadow: var(--shadow2);
               z-index: 60;">
          <div class="flexBetween">
            <div style="font-weight:900;">Snabbhjälp</div>
            <button class="iconBtn" id="helpClose" type="button" aria-label="Stäng hjälp">✕</button>
          </div>

          <div class="muted small mt12">
            <div><span class="kbd">/</span> fokuserar sök</div>
            <div><span class="kbd">Esc</span> stänger paneler</div>
          </div>

          <hr class="hr" />

          <div style="font-weight:900; margin-bottom:6px;">Så funkar sidan</div>
          <ul class="muted small" style="margin:0 0 0 18px;">
            <li>Sök i listan med textfältet (recept, ingrediens, artikelnummer/GTIN).</li>
            <li>Filtrera på Typ/Status/Kategori.</li>
            <li>Klicka på en rad för detaljer i högerpanelen.</li>
            <li>Måltidsrecept visar vilka underrecept som ingår.</li>
          </ul>
        </div>
      </div>
    </div>
  </header>

  <main class="container">

    <!-- HERO (centralt sök – Bild 5 känsla) -->
    <section class="hero">
      <h1 class="heroTitle">Sök recept</h1>
      <p class="heroSub">Skriv för att filtrera. Klicka på en rad för att öppna detaljer i ett eget fönster.</p>

      <!-- Sökfältet flyttat hit (som du markerade) -->
      <div class="searchWrap" style="max-width:920px; width:100%; margin-top:12px;">
        <svg class="searchIcon" viewBox="0 0 24 24" aria-hidden="true">
          <path fill="currentColor" d="M10 4a6 6 0 1 1 3.87 10.58l4.28 4.28-1.42 1.42-4.28-4.28A6 6 0 0 1 10 4m0 2a4 4 0 1 0 0 8a4 4 0 0 0 0-8Z"/>
        </svg>
        <input id="q" class="searchInput" type="search" placeholder="Sök recept, ingrediens, artikelnummer…" autocomplete="off" />
        <span class="kbd" title="Snabbtangent">/</span>
      </div>

      <div class="chipsRow" aria-label="Filter">
        <div class="chip">
          <label for="typeSel">Typ</label>
          <select id="typeSel" aria-label="Typ">
            <option value="all">Alla</option>
            <option value="meal">Måltidsrecept</option>
            <option value="sub">Underrecept</option>
          </select>
        </div>

        <div class="chip">
          <label for="statusSel">Status</label>
          <select id="statusSel" aria-label="Status">
            <option value="active">Aktiva</option>
            <option value="all">Alla</option>
            <option value="inactive">Inaktiva</option>
          </select>
        </div>

        <div class="chip">
          <label for="catSel">Kategori</label>
          <select id="catSel" aria-label="Kategori">
            <option value="all">Alla</option>
            <option value="husman">Husman</option>
            <option value="soppa">Soppa</option>
            <option value="tillbehor">Tillbehör</option>
            <option value="sas">Sås</option>
            <option value="bas">Bas</option>
          </select>
        </div>

        <div class="chip">
          <label for="compactChk">Kompakt</label>
          <input id="compactChk" type="checkbox" aria-label="Kompakt vy" />
        </div>
      </div>
    </section>

    <div class="sectionTitle">
      <h2>Resultat</h2>
      <div class="meta" id="meta">0 träffar</div>
    </div>

    <!-- TABELL (endast "måste-kolumner") -->
    <section class="card tableCard">
      <table class="table" id="tbl" aria-label="Receptlista">
        <thead>
          <tr>
            <th style="width:46%;">Namn</th>
            <th style="width:20%;">Måltidsnamn</th>
            <th style="width:10%;">Typ</th>
            <th style="width:10%;">Pris</th>
            <th style="width:10%;">Status</th>
            <th class="actions" style="width:4%;">Åtgärd</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </section>

  </main>

  <!-- SELECTION PANEL (Bild 5-stil, visas vid markeringar) -->
  <aside class="selectionPanel" id="selPanel" aria-label="Valda recept">
    <div class="selectionHeader">
      <div class="title">Valda recept (<span id="selCount">0</span>)</div>
      <button class="iconBtn" id="selClose" title="Stäng" aria-label="Stäng">✕</button>
    </div>
    <div class="selectionBody" id="selBody"></div>
    <div style="padding:12px 14px; border-top:1px solid var(--border); display:flex; gap:10px;">
      <button class="btn w100" id="bulkInactive">Markera inaktiv</button>
      <button class="btn btnPrimary w100" id="bulkOpen">Öppna detaljer</button>
    </div>
  </aside>

  <!-- OVERLAY + DRAWER -->
  <div class="overlay" id="overlay" aria-hidden="true"></div>
  <aside class="drawer" id="drawer" aria-label="Detaljer">
    <div class="drawerHeader">
      <div>
        <div class="drawerTitle" id="dTitle">Detaljer</div>
        <div class="muted small" id="dSub"></div>
      </div>
      <button class="iconBtn" id="dClose" title="Stäng" aria-label="Stäng">✕</button>
    </div>

    <div class="drawerBody">
      <div class="tabs" role="tablist" aria-label="Detaljflikar">
        <button class="tab active" data-tab="overview" type="button">Översikt</button>
        <button class="tab" data-tab="climate" type="button">Klimat & näring</button>
        <button class="tab" data-tab="ingredients" type="button">Ingredienser</button>
        <button class="tab" data-tab="history" type="button">Historik</button>
      </div>

      <div id="tab_overview">
        <div class="field">
          <label>Namn</label>
          <input class="input" id="fName" type="text" />
          <div class="errorText" id="eName" style="display:none;"></div>
        </div>

        <div class="field">
          <label>Måltidsnamn</label>
          <input class="input" id="fMealName" type="text" />
        </div>

        <div class="field">
          <label>Status</label>
          <select id="fStatus">
            <option value="active">Aktiv</option>
            <option value="inactive">Inaktiv</option>
          </select>
        </div>

        <div class="flexBetween mt16">
          <button class="btn" id="dupBtn">Duplicera</button>
          <button class="btn btnPrimary" id="saveBtn">Spara</button>
        </div>
        <p class="muted small mt12" id="saveNote"></p>
      </div>

      <div id="tab_climate" style="display:none;">
        <div class="card" style="padding:14px; box-shadow:none;">
          <div class="flexBetween">
            <div>
              <div style="font-weight:900;">Koldioxidekvivalenter</div>
              <div class="muted small">Visa i panel, inte i listan.</div>
            </div>
            <span class="badge badgeMuted" id="co2Badge">—</span>
          </div>
          <hr class="hr" />
          <div class="flexBetween">
            <div>
              <div style="font-weight:900;">Energidistribution</div>
              <div class="muted small">Fett / Kolhydrater / Protein</div>
            </div>
            <span class="badge badgeMuted" id="energyBadge">—</span>
          </div>
          <hr class="hr" />
          <div class="flexBetween">
            <div>
              <div style="font-weight:900;">Måltidsstorlek</div>
              <div class="muted small">Portionsvikt</div>
            </div>
            <span class="badge badgeMuted" id="sizeBadge">—</span>
          </div>
          <hr class="hr" />
          <div class="field">
            <label>Beskrivning</label>
            <textarea class="input" id="fDesc" rows="5" style="resize:vertical;"></textarea>
          </div>
        </div>
      </div>

      <div id="tab_ingredients" style="display:none;">
        <p class="muted small">Måltidsrecept visar underrecept + ingredienser.</p>
        <div id="ingList" class="card" style="padding:14px; box-shadow:none;"></div>
      </div>

      <div id="tab_history" style="display:none;">
        <p class="muted small">Visar datum + vad som ändrades (demo).</p>
        <div id="histList" class="card" style="padding:14px; box-shadow:none;"></div>
      </div>
    </div>
  </aside>

  <!-- Page init: använder 10 fejk-recept -->
  <script type="module">
    import { initRecipesPage } from '../assets/js/pages/recipes.page.js';
    initRecipesPage();

    // Hjälpruta (popover) – liten, enkel
    const $ = (s) => document.querySelector(s);
    const btn = $('#helpBtn');
    const pop = $('#helpPop');
    const close = $('#helpClose');

    function openHelp(){
      pop.style.display = '';
      btn.setAttribute('aria-expanded', 'true');
      // Klick utanför stänger
      setTimeout(() => {
        const onDoc = (e) => {
          if (!pop.contains(e.target) && e.target !== btn){
            document.removeEventListener('mousedown', onDoc);
            closeHelp();
          }
        };
        document.addEventListener('mousedown', onDoc);
      }, 0);
    }
    function closeHelp(){
      pop.style.display = 'none';
      btn.setAttribute('aria-expanded', 'false');
    }

    btn.addEventListener('click', () => {
      const isOpen = pop.style.display !== 'none' && pop.style.display !== '';
      if (isOpen) closeHelp();
      else openHelp();
    });
    close.addEventListener('click', closeHelp);

    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeHelp();
    });
  </script>

</body>
</html>
